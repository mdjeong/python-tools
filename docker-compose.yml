# Docker Compose 파일의 버전을 명시합니다.
version: '3.8'

services:
  # 서비스(컨테이너)의 이름을 정의합니다. 여기서는 'api-container'라고 지었습니다.
  api-container:
    # 이미지를 빌드하기 위한 설정을 정의합니다.
    build:
      # 빌드 컨텍스트(경로)를 현재 폴더(.)로 설정합니다.
      context: .
      # 사용할 Dockerfile의 이름을 지정합니다.
      dockerfile: Dockerfile
    
    # 포트 포워딩을 설정합니다.
    # 호스트(내 컴퓨터)의 8833 포트를 컨테이너의 8000 포트와 연결합니다.
    # 즉, http://localhost:8833 으로 접속하면 컨테이너의 8000번으로 연결됩니다.
    ports:
      - "8833:8000"
    
    # 볼륨을 마운트합니다.
    # 현재 폴더(.)를 컨테이너 내부의 /app 폴더와 동기화합니다.
    # 이렇게 하면 코드를 수정했을 때 컨테이너를 다시 빌드하지 않아도 바로 반영됩니다.
    volumes:
      - .:/app
    
    # 환경 변수 파일을 지정합니다. .env 파일에 있는 내용을 컨테이너 환경 변수로 로드합니다.
    env_file:
      - .env
    
    # 추가적인 환경 변수를 직접 설정합니다.
    environment:
      # 파이썬 출력이 버퍼링되지 않고 바로 출력되도록 설정합니다. (로그 확인 용이)
      - PYTHONUNBUFFERED=1
    
    # 컨테이너가 중지되거나 오류가 나도 항상 자동으로 재시작하도록 설정합니다.
    restart: always